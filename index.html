<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Film Journal - Pink Browser Search</title>

  <link href="https://fonts.googleapis.com/css2?family=Satisfy&family=Gravitas+One&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.2/color-thief.umd.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    html, body {
      margin: 0; padding: 0; width: 100vw; height: 100vh;
      background: #eaf3fb url('film journal-1.jpg') center center / cover no-repeat;
      overflow: hidden; transition: background 0.4s ease;
    }
    .browser-bg { display: none; position: fixed; left: 0; top: 0; width: 100vw; height: 100vh;
      z-index: 50; align-items: center; justify-content: center; background: rgba(255,255,255,0.25); }
    .browser-window { width: 750px; height: 660px; border-radius: 26px; background: #fff;
      box-shadow: 0 12px 82px #dfa0ee25, 0 0 0 3.5px #fbd3f7; display: flex; flex-direction: column; align-items: center;
      position: relative; border: 3.7px solid #fab3e7; }
    .browser-bar { width:100%; height:72px; background:#ffd3ec; border-radius:26px 26px 0 0;
      display:flex; align-items:center; justify-content:center; position:relative; }
    .bar-title { font-family: 'Gravitas One'; font-size: 2rem; color: #eb67b6; }
    .bar-x { position:absolute; right:16px; top:50%; transform:translateY(-50%);
      background:none; border:none; color:#e27db3; font-size:1.8rem; font-weight:bold; cursor:pointer; }
    .search-wrap { width:84%; margin:52px auto 0; display:flex; flex-direction:column; align-items:center; }
    .search-form-browser { display:flex; width:100%; align-items:center; background:#ffeef5; border-radius:12px;
      box-shadow:0 3px 14px #fab3e73a; border:1.2px solid #fbd7e7; padding:9px 10px; }
    .search-input { border:none; background:none; font-size:1.32rem; padding:16px 24px; border-radius:9px; outline:none; width:78%;
      color:#e36ad5; font-family:'Satisfy', cursive; font-weight:600; background:#fffafc; margin-right:7px; }
    .search-btn { background:#fa8ecb; color:#fff; border:none; border-radius:9px; padding:0px 30px; font-weight:700; height: 100%;  cursor:pointer;transition: background 0.2s ease;}
    .center-palette-wrap { position:absolute; left:50%; top:63%; transform:translate(-50%,-50%); display:flex; align-items:center; }
    .poster-img { width:200px; border-radius:18px; box-shadow:0 10px 48px #c9b6fa38; border:2.2px solid #e5b6e8; object-fit:cover; }
    .palette-vertical { display:flex; flex-direction:column; gap:20px; margin-left:24px; align-items:center; }
    .color-circle { width:58px; height:58px; border-radius:50%; border:3px solid #ffd3ec; box-shadow:0 3px 17px #bdbdfb14; cursor:pointer; }
    .browser-footer { width:100%; height:60px; background:#f3f3f3; position:absolute; bottom:0; left:0; border-radius:0 0 26px 26px;
      display:flex; align-items:center; justify-content:center; }
    .save-btn { background:none; border:2px solid #ffb5d9; color:#ffb5d9; font-size:1.3rem; font-weight:700; border-radius:50px; padding:10px 42px;
      cursor:pointer; display:none; }
    .go-btn { position:fixed; left:50%; bottom:28px; transform:translateX(-50%);
      border:2.7px solid #ed97b5; background:#fff; color:#ed97b5; border-radius:50px;
      font-size:2.1rem; font-family:'Segoe UI'; font-weight:700; padding:18px 75px;
      letter-spacing:.7px; box-shadow:0 4px 22px #ed97b544; cursor:pointer; outline:none; z-index:2;transition: all 0.15s ease;}
      .go-btn:active {
      background:#ed97b5;   
      color:#fff;          
      box-shadow:0 2px 10px rgba(237,151,181,0.6);
      transform:translateX(-50%) scale(0.96); 
}

    .editor-chrome {
      display:none; position:fixed; inset:0; z-index:120;
      background: var(--tint, #ffffff);
      transition: background .4s ease;
    }
    .editor-chrome::after {
      content:""; position:absolute; inset:0;
      background-image: radial-gradient(circle at 1px 1px, rgba(0,0,0,.08) 1px, transparent 0);
      background-size: 22px 22px; pointer-events:none;
    }
    .editor-header { position:absolute; left:28px; top:18px; display:flex; flex-direction:column; gap:12px; z-index:2; }
    .movie-title { font-weight:900; font-size:48px; color:#ef75c0; margin:0; }
    .editor-info { display:flex; align-items:flex-start; gap:16px; }
    .editor-poster { width:140px; height:200px; border-radius:14px; border:2px solid #ffd1ea; object-fit:cover; }
    .editor-palette { display:flex; flex-direction:column; gap:12px; }
    .editor-swatch {
      width:40px; height:40px; border-radius:10px;
      border:3px solid #ffffff; box-shadow:0 6px 18px rgba(239,117,192,.35);
      cursor:pointer; transition:transform .18s ease;
    }
    .editor-swatch:hover { transform:scale(1.1); }

    .editor-save { position:absolute; right:24px; top:20px;
      background:#fff; color:#ef75c0; border:2px solid #ef75c0; border-radius:999px;
      padding:10px 22px; font-weight:800; cursor:pointer; z-index:1100; }

    #drawCanvas { position:absolute; inset:0; z-index:1; }

    .tool-strip {
      position:absolute; bottom:72px; left:50%; transform:translateX(-50%);
      display:flex; gap:56px; align-items:center; padding:10px 16px;
      overflow:visible; z-index:1000;
    }
    .tool-item {
      font-size:1.05rem; font-weight:800; color:#ef75c0;
      border:2px solid #ef75c0; border-radius:999px; padding:12px 28px; background:#fff;
      box-shadow:0 6px 20px rgba(239,117,192,.15);
      cursor:pointer; transition:transform .22s ease, box-shadow .22s ease, background .22s ease, color .22s ease;
      position:relative; user-select:none;
      white-space: nowrap;
    }
    .tool-item:hover { transform:translateY(-26px) scale(1.12); background:#ef75c0; color:#fff; box-shadow:0 12px 36px rgba(239,117,192,.3); }
    .tool-item.active { background:#ef75c0; color:#fff; }

    .panel {
      position:absolute; bottom:200px; left:50%; transform:translateX(-50%);
      display:none; padding:12px 14px; border:2px solid #ef75c0; border-radius:14px;
      background:rgba(255,255,255,.9); backdrop-filter: blur(6px);
      color:#ef75c0; font-weight:700; box-shadow:0 16px 40px rgba(239,117,192,.25); z-index:1050;
      white-space:nowrap; align-items:center; gap:12px;
    }
    .panel.visible { display:flex; }
    .panel label { font-size:12px; opacity:.9; }

    .color-chip {
      width:34px; height:34px; border-radius:10px; border:2px solid #ef75c0;
      box-shadow:0 6px 16px rgba(239,117,192,.25); cursor:pointer; position:relative; background:#ef75c0;
    }
    .color-popover {
      position:absolute; bottom:46px; left:50%; transform:translateX(-50%);
      background:rgba(255,240,247,.96); border:2px solid #ef75c0; border-radius:14px;
      padding:12px; display:none; gap:8px; align-items:center; box-shadow:0 18px 46px rgba(239,117,192,.28);
    }
    .color-popover.open { display:flex; }
    .swatch {
      width:26px; height:26px; border-radius:50%; border:2px solid #fff;
      box-shadow:0 3px 10px rgba(239,117,192,.25); cursor:pointer;
    }
    .color-input {
      appearance:none; width:34px; height:34px; border:none; border-radius:10px; padding:0; cursor:pointer;
      box-shadow:0 3px 10px rgba(239,117,192,.25);
    }

    .panel input[type="range"] { width:160px; accent-color:#ef75c0; }
    .panel select { border:2px solid #ef75c0; border-radius:10px; padding:6px 8px; color:#ef75c0; background:#fff; font-weight:700; }

    .box {
      position:absolute; border:2px dashed #ef75c0; border-radius:12px; padding:6px; background:#ffffffbb;
      box-shadow:0 10px 30px rgba(239,117,192,.18); cursor:move; z-index:900;
    }
    .box.selected { border-style:solid; box-shadow:0 16px 44px rgba(239,117,192,.3); }
    .handle { position:absolute; width:12px; height:12px; border-radius:50%; background:#ef75c0; right:-8px; bottom:-8px; cursor:nwse-resize; box-shadow:0 0 0 2px #fff; }
    .delete-btn { position:absolute; right:-10px; top:-10px; width:20px; height:20px; background:#ef75c0; color:#fff; border:none; border-radius:50%; font-size:12px; font-weight:800; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,.15); line-height:20px; }

    .preview { display:flex; align-items:center; gap:8px; }
    .sticker { font-size:22px; line-height:1; padding:6px 8px; border-radius:8px; border:2px solid #ef75c0; background:#fff; cursor:pointer; }
    .note-chip { width:28px; height:28px; border-radius:6px; border:2px solid #ef75c0; cursor:pointer; }
  </style>
</head>

<body>
  <button class="go-btn" id="goBtn">Go</button>

  <div class="browser-bg" id="browserBg">
    <div class="browser-window">
      <div class="browser-bar">
        <span class="bar-title">Film Journal - Search</span>
        <button class="bar-x" id="modalCloseBtn">&#10006;</button>
      </div>
      <div class="search-wrap">
        <form class="search-form-browser" id="searchForm">
          <input class="search-input" id="movieInput" type="text" placeholder="search movie in English correctly" autocomplete="off" />
          <button class="search-btn" type="submit">search</button>
        </form>
      </div>
      <div class="center-palette-wrap" id="resultArea" style="display:none;">
        <img class="poster-img" id="posterImg" src="" alt="movie-poster" crossorigin="anonymous" />
        <div class="palette-vertical" id="paletteVertical"></div>
      </div>
      <div class="browser-footer">
        <button class="save-btn" id="saveBtn">select!</button>
      </div>
    </div>
  </div>

  <section class="editor-chrome" id="editorChrome">
    <div class="editor-header">
      <h1 class="movie-title" id="edTitle">Title</h1>
      <div class="editor-info">
        <img id="edPoster" class="editor-poster" alt="poster" />
        <div id="edPalette" class="editor-palette"></div>
      </div>
    </div>

    <button class="editor-save" id="saveBoard">save</button>
    <canvas id="drawCanvas"></canvas>

    <div class="tool-strip" id="toolStrip"></div>

    <div class="panel" id="toolPanel"></div>

    <input type="file" id="imgPicker" accept="image/*" multiple style="display:none" />
  </section>

  <script>

    const goBtn=document.getElementById('goBtn');
    const browserBg=document.getElementById('browserBg');
    const modalCloseBtn=document.getElementById('modalCloseBtn');
    const searchForm=document.getElementById('searchForm');
    const movieInput=document.getElementById('movieInput');
    const resultArea=document.getElementById('resultArea');
    const posterImg=document.getElementById('posterImg');
    const saveBtn=document.getElementById('saveBtn');

    goBtn.onclick=()=>{goBtn.style.display='none';browserBg.style.display='flex';};
    modalCloseBtn.onclick=()=>{browserBg.style.display='none';goBtn.style.display='block';resultArea.style.display="none";posterImg.src="";movieInput.value="";saveBtn.style.display='none';};

    searchForm.onsubmit=async e=>{
      e.preventDefault();
      const title=movieInput.value.trim(); if(!title) return;
      const data=await fetch(`https://www.omdbapi.com/?t=${encodeURIComponent(title)}&apikey=b89bc010`).then(r=>r.json());
      if(data&&data.Poster&&data.Poster!=='N/A'){
        posterImg.src=data.Poster; resultArea.style.display="flex";
        saveBtn.style.display='block';
        saveBtn.dataset.poster=data.Poster; saveBtn.dataset.title=data.Title||title;
      }else alert("영화 포스터를 찾을 수 없습니다.");
    };

    saveBtn.addEventListener('click', ()=>{
      localStorage.setItem('savedPoster',saveBtn.dataset.poster||'');
      localStorage.setItem('savedTitle',saveBtn.dataset.title||movieInput.value.trim());
      browserBg.style.display='none';
      document.getElementById('editorChrome').style.display='block';
      initEditor();
    });


    const editor = document.getElementById('editorChrome');
    const edTitle = document.getElementById('edTitle');
    const edPoster = document.getElementById('edPoster');
    const edPalette = document.getElementById('edPalette');
    const drawCanvas = document.getElementById('drawCanvas');
    const dctx = drawCanvas.getContext('2d');
    const toolStrip = document.getElementById('toolStrip');
    const toolPanel = document.getElementById('toolPanel');
    const imgPicker = document.getElementById('imgPicker');

    const state = {
      tool: 'pencil',
      pencil: { size: 3 },
      pen:    { size: 6, color: '#ef75c0' },
      eraser: { size: 24 },
      text:   { size: 36, family: 'serif', color: '#222' },
      draw: { active:false, lastX:0, lastY:0 }
    };

    function sizeCanvas() {
      drawCanvas.width = innerWidth;
      drawCanvas.height = innerHeight;
    }
    window.addEventListener('resize', sizeCanvas);

    function initEditor(){
      sizeCanvas();

      edTitle.textContent = localStorage.getItem('savedTitle') || 'Title';
      edPoster.src = localStorage.getItem('savedPoster') || '';

      edPoster.onload = () => {
        const thief = new ColorThief();
        let cols = [];
        try { cols = thief.getPalette(edPoster, 3); } catch(e) { cols = [[239,117,192],[106,124,255],[17,17,17]]; }
        cols.push([255,255,255]);
        edPalette.innerHTML = '';
        cols.forEach(rgb=>{
          const sw = document.createElement('div');
          const css = `rgb(${rgb[0]},${rgb[1]},${rgb[2]})`;
          sw.className='editor-swatch';
          sw.style.background = css;
          sw.title = css;
          sw.onclick = ()=> editor.style.setProperty('--tint', css);
          edPalette.appendChild(sw);
        });
      };

      buildToolbar();
      bindDrawing();
    }

    function setTool(t){
      state.tool=t;
      [...toolStrip.children].forEach(c=>c.classList.toggle('active', c.dataset.tool===t));
      renderPanelFor(t);
    }

    function bindDrawing(){
      drawCanvas.addEventListener('mousedown', e=>{
        if(state.tool==='text') return; 
        state.draw.active=true;
        const p=canvasPoint(e); state.draw.lastX=p.x; state.draw.lastY=p.y;
        strokeTo(p.x,p.y,true);
      });
      drawCanvas.addEventListener('mousemove', e=>{
        if(!state.draw.active || state.tool==='text') return;
        const p=canvasPoint(e); strokeTo(p.x,p.y,false);
      });
      window.addEventListener('mouseup', ()=> state.draw.active=false);

      drawCanvas.addEventListener('touchstart', e=>{
        if(state.tool==='text') return;
        e.preventDefault(); const t=e.touches[0];
        state.draw.active=true; const p=canvasPoint(t); state.draw.lastX=p.x; state.draw.lastY=p.y; strokeTo(p.x,p.y,true);
      }, {passive:false});
      drawCanvas.addEventListener('touchmove', e=>{
        if(!state.draw.active || state.tool==='text') return;
        e.preventDefault(); const t=e.touches[0]; const p=canvasPoint(t); strokeTo(p.x,p.y,false);
      }, {passive:false});
      window.addEventListener('touchend', ()=> state.draw.active=false);

      drawCanvas.addEventListener('click', e=>{
        if(state.tool!=='text') return;
        const p=canvasPoint(e);
        spawnTextBox(p.x, p.y, 'text here');
      });
    }

    function canvasPoint(e){
      const r = drawCanvas.getBoundingClientRect();
      return { x: e.clientX - r.left, y: e.clientY - r.top };
    }

    function strokeTo(x,y,start){
      dctx.lineJoin='round'; dctx.lineCap='round';
      if(state.tool==='eraser'){
        dctx.globalCompositeOperation='destination-out';
        dctx.strokeStyle='#000'; dctx.lineWidth=state.eraser.size; dctx.globalAlpha=1;
      }else{
        dctx.globalCompositeOperation='source-over';
        const size = (state.tool==='pencil'?state.pencil.size:state.pen.size);
        const color= (state.tool==='pencil'?'rgba(50,50,60,.9)':state.pen.color);
        dctx.strokeStyle=color; dctx.lineWidth=size; dctx.globalAlpha=1;
      }
      dctx.beginPath();
      dctx.moveTo(state.draw.lastX, state.draw.lastY);
      dctx.lineTo(x,y);
      dctx.stroke();
      state.draw.lastX=x; state.draw.lastY=y;
    }

    function makeDraggableResizable(el, content){
      el.classList.add('box');
      el.appendChild(content);

      const del=document.createElement('button');
      del.className='delete-btn';
      del.textContent='×';
      del.title='delete';
      del.addEventListener('click', (ev)=>{ ev.stopPropagation(); el.remove(); });
      el.appendChild(del);

      const h=document.createElement('div');
      h.className='handle';
      el.appendChild(h);

      document.body.appendChild(el);

      let drag=false, sx=0, sy=0, ox=0, oy=0;
      el.addEventListener('mousedown', ev=>{
        if(ev.target===h) return; // 리사이즈
        drag=true; el.classList.add('selected');
        sx=ev.clientX; sy=ev.clientY; ox=el.offsetLeft; oy=el.offsetTop;
        ev.preventDefault();
      });
      window.addEventListener('mousemove', ev=>{
        if(!drag) return;
        el.style.left=(ox+ev.clientX-sx)+'px';
        el.style.top =(oy+ev.clientY-sy)+'px';
      });
      window.addEventListener('mouseup', ()=>{ drag=false; el.classList.remove('selected'); });

      let res=false, sw=0, sh=0, rsx=0, rsy=0;
      h.addEventListener('mousedown', ev=>{
        res=true; rsx=ev.clientX; rsy=ev.clientY; sw=el.offsetWidth; sh=el.offsetHeight; ev.stopPropagation(); ev.preventDefault();
      });
      window.addEventListener('mousemove', ev=>{
        if(!res) return;
        const dw = ev.clientX - rsx, dh = ev.clientY - rsy;
        el.style.width  = Math.max(60, sw+dw) + 'px';
        el.style.height = Math.max(40, sh+dh) + 'px';
      });
      window.addEventListener('mouseup', ()=> res=false);
    }

    function spawnTextBox(x,y,text){
      const wrap=document.createElement('div');
      wrap.style.left=x+'px'; wrap.style.top=y+'px'; wrap.style.width='260px'; wrap.style.height='auto';wrap.style.position = 'absolute';wrap.style.zIndex = '1200';

      const content=document.createElement('div');
      content.textContent=text||'text here';
      content.contentEditable='false';
      content.style.minHeight='40px';
      content.style.outline='none';
      applyTextStyle(content);

      content.addEventListener('dblclick', ()=>{
        content.contentEditable='true';
        const range = document.createRange();range.selectNodeContents(content);
        const sel = window.getSelection();sel.removeAllRanges();sel.addRange(range);
        content.focus();
        openTextEditPanel(content);
  });
      content.addEventListener('blur', ()=>{ content.contentEditable='false'; });

      makeDraggableResizable(wrap, content);
    }
    function applyTextStyle(node){
      node.style.fontSize=state.text.size+'px';
      node.style.color = state.text.color;
      node.style.fontFamily = (state.text.family==='serif'?'Times New Roman, serif': state.text.family==='sans'?'system-ui, -apple-system, Segoe UI, Roboto, Arial':'"Satisfy", cursive');
    }
    function openTextEditPanel(target) {
    toolPanel.classList.add('visible');
    toolPanel.innerHTML = '';
    
    const sizeLabel = document.createElement('label');
    sizeLabel.textContent = '크기';
    const sizeRange = document.createElement('input');
    sizeRange.type = 'range';
    sizeRange.min = 12;
    sizeRange.max = 120;
    sizeRange.value = parseInt(getComputedStyle(target).fontSize);
    sizeRange.oninput = () => {
    target.style.fontSize = sizeRange.value + 'px';
  };
  toolPanel.append(sizeLabel, sizeRange);

    const colorLabel = document.createElement('label');
    colorLabel.textContent = '색상';
    const colorPicker = document.createElement('input');
    colorPicker.type = 'color';
    colorPicker.value = rgbToHex(getComputedStyle(target).color);
    colorPicker.oninput = () => {
    target.style.color = colorPicker.value;
  };
  toolPanel.append(colorLabel, colorPicker);

    const fontLabel = document.createElement('label');
  fontLabel.textContent = '폰트';
  const fontSelect = document.createElement('select');
  fontSelect.innerHTML =
    '<option value="serif">명조</option><option value="sans">고딕</option><option value="cursive">필기체</option>';
  const currentFont = getComputedStyle(target).fontFamily;
  fontSelect.value =
    currentFont.includes('Times') ? 'serif' :
    currentFont.includes('system-ui') ? 'sans' : 'cursive';
  fontSelect.oninput = () => {
    const val = fontSelect.value;
    target.style.fontFamily =
      val === 'serif'
        ? 'Times New Roman, serif'
        : val === 'sans'
        ? 'system-ui, -apple-system, Segoe UI, Roboto, Arial'
        : '"Satisfy", cursive';
  };
  toolPanel.append(fontLabel, fontSelect);
}
    function rgbToHex(rgb) {
  const result = rgb
    .match(/\d+/g)
    ?.map((x) => parseInt(x).toString(16).padStart(2, '0'))
    .join('');
  return result ? `#${result}` : '#000000';
}

     function spawnImageBox(src, x=200, y=200){
      const wrap=document.createElement('div');
      wrap.style.left=x+'px'; wrap.style.top=y+'px'; wrap.style.width='280px'; wrap.style.height='200px';
      const img=new Image(); img.src=src; img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover'; img.style.borderRadius='8px';
      makeDraggableResizable(wrap, img);
    }

    function spawnNote(color, x=260, y=260){
      const wrap=document.createElement('div');
      wrap.style.left=x+'px'; wrap.style.top=y+'px'; wrap.style.width='220px'; wrap.style.height='200px';
      const note=document.createElement('div');
      note.contentEditable='true';
      note.style.width='100%'; note.style.height='100%';
      note.style.background=color; note.style.borderRadius='8px';
      note.style.padding='12px'; note.style.font='700 18px/1.4 system-ui, -apple-system, Segoe UI';
      note.style.color='#333';
      makeDraggableResizable(wrap, note);
    }

    function spawnSticker(emoji, x=320, y=320){
      const wrap=document.createElement('div');
      wrap.style.left=x+'px'; wrap.style.top=y+'px'; wrap.style.width='90px'; wrap.style.height='90px';
      const s=document.createElement('div');
      s.style.width='100%'; s.style.height='100%'; s.style.display='flex'; s.style.alignItems='center'; s.style.justifyContent='center';
      s.style.fontSize='56px'; s.textContent=emoji;
      makeDraggableResizable(wrap, s);
    }

    function renderPanelFor(tool){
      toolPanel.classList.add('visible');
      toolPanel.innerHTML='';

      if(tool==='pencil'){
        toolPanel.append(label('두께'));
        toolPanel.append(range(state.pencil.size,1,24,v=>state.pencil.size=+v));
      }
      else if(tool==='pen'){
        toolPanel.append(label('색'));
        toolPanel.append(makeColorPopover((val)=>{ state.pen.color = val; }));
        toolPanel.append(label('두께'));
        toolPanel.append(range(state.pen.size,1,32,v=>state.pen.size=+v));
      }
      else if(tool==='eraser'){
        toolPanel.append(label('크기'));
        toolPanel.append(range(state.eraser.size,8,80,v=>state.eraser.size=+v));
      }
      else if(tool==='text'){
        toolPanel.append(label('폰트'));
        const sel=document.createElement('select');
        sel.innerHTML='<option value="serif">명조</option><option value="sans">고딕</option><option value="cursive">필기체</option>';
        sel.value=state.text.family; sel.oninput=()=>state.text.family=sel.value;
        toolPanel.append(sel);

        toolPanel.append(label('크기'));
        toolPanel.append(range(state.text.size,16,120,v=>state.text.size=+v));

        toolPanel.append(label('색'));
        toolPanel.append(makeColorPopover((val)=>{ state.text.color = val; }));
      }
      else if(tool==='image'){
        const btn=document.createElement('button'); btn.textContent='이미지 불러오기';
        styleGhostButton(btn); btn.onclick=()=>imgPicker.click();
        toolPanel.append(btn);
      }
      else if(tool==='sticker'){
        toolPanel.append(label('스티커'));
        const box=document.createElement('div'); box.className='preview';
        ['💖','⭐','😊','✨','🎬'].forEach(e=>{
          const b=document.createElement('div'); b.className='sticker'; b.textContent=e;
          b.onclick=()=>spawnSticker(e);
          box.appendChild(b);
        });
        toolPanel.append(box);
      }
      else if(tool==='post-it'){
        toolPanel.append(label('색'));
        const box=document.createElement('div'); box.className='preview';
        ['#fff59d','#b2f5ea','#ffd1ea'].forEach(c=>{
          const n=document.createElement('div'); n.className='note-chip'; n.style.background=c;
          n.onclick=()=>spawnNote(c);
          box.appendChild(n);
        });
        toolPanel.append(box);
      }
    }

    function makeColorPopover(onPick){
      const chip=document.createElement('div');
      chip.className='color-chip';
      const pop=document.createElement('div');
      pop.className='color-popover';

      const presets=['#ef75c0','#6a7cff','#111111','#3b82f6','#10b981','#f59e0b','#e11d48'];
      presets.forEach(c=>{
        const s=document.createElement('div'); s.className='swatch'; s.style.background=c;
        s.title=c; s.onclick=()=>{ onPick(c); chip.style.background=c; pop.classList.remove('open'); };
        pop.appendChild(s);
      });

      const custom=document.createElement('input');
      custom.type='color'; custom.className='color-input'; custom.value='#ef75c0';
      custom.oninput=()=>{ onPick(custom.value); chip.style.background=custom.value; };
      pop.appendChild(custom);

      chip.onclick=(e)=>{ e.stopPropagation(); pop.classList.toggle('open'); };
      document.addEventListener('click',()=>pop.classList.remove('open'));

      const wrap=document.createElement('div'); wrap.style.position='relative';
      wrap.append(chip,pop);
      return wrap;
    }

    function label(t){ const l=document.createElement('label'); l.textContent=t; return l; }
    function range(val,min,max,on){ const r=document.createElement('input'); r.type='range'; r.min=min; r.max=max; r.value=val; r.oninput=()=>on(r.value); return r; }
    function styleGhostButton(b){ b.style.border='2px solid #ef75c0'; b.style.background='#fff'; b.style.color='#ef75c0'; b.style.fontWeight='800'; b.style.borderRadius='10px'; b.style.padding='8px 12px'; b.style.cursor='pointer'; }

    function buildToolbar(){
      const tools=['pencil','pen','eraser','text','image','sticker','post-it'];
      toolStrip.innerHTML='';
      tools.forEach(t=>{
        const it=document.createElement('div');
        it.className='tool-item'; it.dataset.tool=t; it.textContent=t;
        it.addEventListener('mouseenter', ()=>{ setTool(t); });
        it.addEventListener('click', ()=>{ setTool(t); });
        toolStrip.appendChild(it);
      });
      setTool('text'); 
    }

    imgPicker.addEventListener('change', (e)=>{
      const files=[...e.target.files];
      files.forEach(f=>{
        const url=URL.createObjectURL(f);
        spawnImageBox(url, 200+Math.random()*120, 180+Math.random()*120);
      });
      e.target.value='';
    });

    document.getElementById('saveBoard').addEventListener('click', async ()=>{
      const shot = await html2canvas(editor, {backgroundColor: null, useCORS:true, scale:2});
      const a=document.createElement('a'); a.download='film-journal-board.png'; a.href=shot.toDataURL('image/png'); a.click();
    });
  </script>
</body>
</html>
